<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falconstead</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Suppressing the favicon error -->
    <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAA..." />
</head>

<script src="./websocket_client/js/htx_okx_spread_order.js"></script>
<link href="./websocket_client/css/statusbadge.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="websocket_client/css/arbButton.css">
<!-- <link rel="stylesheet" href="websocket_client/css/util.css"> -->
<link rel="stylesheet" href="websocket_client/css/algoTable.css">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">

<!-- sorting table -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!-- Include this once in your HTML -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="./websocket_client/js/update_currency_based_on_mkt_type.js"></script>





<body class="text-light">
    
    <!-- NAVBAR -->
    <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4 py-2">
        <a class="navbar-brand fw-bold fs-4" href="#">Falconstead</a>
        <div class="ms-auto text-light d-flex align-items-center gap-2">
          <span class="fs-6 text-muted">Welcome,</span>
          <span id="username_intro" class="fw-semibold"></span>
        </div>
      </nav> -->

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <!-- <a class="navbar-brand" href="#">Falconstead <a> Welcome <tag id ="username_intro"></tag> </a> </a>  -->

            <a class="navbar-brand fw-bold fs-4" href="#">Falconstead</a>

            <div class="ms-auto text-light d-flex align-items-center gap-2">
                <span class="fs-6 welcome-text">Welcome,</span>
                <span id="username_intro" class="welcome-text fw-semibold"></span>
            </div>
                  
            <script> document.getElementById('username_intro').innerHTML = localStorage.getItem('username')</script>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" id="navbar-links">
                    
                    <!-- Login Link (Visible when logged out) -->
                    <li class="nav-item" id="login-link">
                        <a class="nav-link" href="auth.html">Login</a>
                    </li>

                    <!-- Logout Link (Visible when logged in) -->
                    <li class="nav-item" id="logout-link" style="display: none;">
                        <a class="nav-link logout-btn" href="#" onclick="logout()">Logout</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
    

    <div class="container-fluid p-0 background ">

        <!-- This section will be visible if the JWT is NOT present -->
        <div id="loginPrompt" class="alert alert-warning text-center">

            <h4>You are not logged in.</h4>
            <p>Please log in to access secured content.</p>

        </div>
        
        <div class = "row px-4 ">

            <!-- WARNING ALERT -->
            <div id="alertBox" class="text-center alert alert-dark alert-dismissible fade show " role="alert">
                <strong id="alertMessage">‚ö†Ô∏è Liquidation Warning!</strong>
                <button type="button" class="btn btn-danger btn ms-3" onclick="stopTwilioCall()">Stop Call</button>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

        </div>

        <div class = "row px-4  " >
            
            <!-- DISPLAY TABLE -->
            <div class="col-lg-6 container-fluid " id="orderbookdisplayContainer ">
                <!-- Container for the funding rates row -->
                <div class=" text-center">
                    <span class="px-3 text-muted fw-medium small text-uppercase header-text">
                      FUNDING RATE
                    </span>
                  </div>
                
                <div class="container-fluid p-3 ">
                    <!-- Control Row -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="input-group bg-white rounded-3 shadow-sm">
                                <span class="input-group-text bg-transparent border-0">
                                    <i class="bi bi-graph-up text-secondary"></i>
                                </span>
                                <select id="market-type" class="form-select border-0 shadow-none" onchange="updateCurrencyOptions()">
                                    <option value="">Select Market</option>
                                    <option value="perp" selected>PERP</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="input-group bg-white rounded-3 shadow-sm">
                                <span class="input-group-text bg-transparent border-0">
                                    <i class="bi bi-currency-dollar text-secondary"></i>
                                </span>
                                <select id="fundingrate-currency-input" class="form-select border-0 shadow-none">
                                    <!-- Options will be populated via JS -->
                                </select>
                            </div>
                        </div>
                    </div>
                
                    <!-- Cards Row -->
                    <div class="row g-3">
                        <!-- OKX Card -->
                        <div class="col-md-3 col-sm-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0 fw-semibold text-muted">OKX</h6>
                                        <span id="fundingratets-okxperp" class="badge  bg-opacity-10 text-warning small">-</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-end">
                                        <span id="currency-okxperp" class="text-muted small">--</span>
                                        <span id="funding-rate-okxperp" class="fw-bold text-primary fs-5">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- HTX Card -->
                        <div class="col-md-3 col-sm-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0 fw-semibold text-muted">HTX</h6>
                                        <span id="fundingratets-htxperp" class="badge  bg-opacity-10 text-warning small">-</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-end">
                                        <span id="currency-htxperp" class="text-muted small">--</span>
                                        <span id="funding-rate-htxperp" class="fw-bold text-primary fs-5">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Binance Card -->
                        <div class="col-md-3 col-sm-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0 fw-semibold text-muted">BINANCE</h6>
                                        <span id="fundingratets_bnb" class="badge  bg-opacity-10 text-warning small">-</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-end">
                                        <span id="currency-binance" class="text-muted small">--</span>
                                        <span id="funding-rate-binance" class="fw-bold text-primary fs-5">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Deribit Card -->
                        <div class="col-md-3 col-sm-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0 fw-semibold text-muted">DERIBIT</h6>
                                        <span id="fundingratets-deribit" class="badge  bg-opacity-10 text-warning small">-</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-end">
                                        <span id="currency-deribit" class="text-muted small">--</span>
                                        <span id="funding-rate-deribit" class="fw-bold text-primary fs-5">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row">
                <!-- ORDERBOOK DISPLAY -->
                <div class="py-1 my-2 text-center">
                    <span class="px-3 text-muted fw-medium small text-uppercase header-text">
                      DISPLAY
                    </span>
                  </div>
                

                        <div class="m-0 p-0">
                        <!-- CHOICES FOR LEADING AND LAGGING EXCHANGES -->
                            <div class="container">
                                <div class="row align-items-center">

                                    <div class="col-md-3 col-sm-12 mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="bi bi-graph-up"></i>
                                            </span>
                                            <select id="market-type-orderbook1" class="form-select" onchange="updateCurrencyOptionsOrderbook1()">
                                                <option value="">Select Market</option>
                                                <!-- <option value="spot" selected>SPOT</option> -->
                                                <option value="perp" selected>PERP</option>
                                                <!-- <option value="futures">FUTURES</option> -->
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Currency Input -->
                                    <div class="col-md-3 col-sm-12 mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
                                            <select id="currency-input-orderbook1" class="form-select" aria-label="Currency" onchange="updateCurrency()">
                                                <option value="">Select Currency</option>
                               
                                            </select>
                                        </div>
                                    </div>


                                    <div class="col-md-3 col-sm-12 mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="bi bi-graph-up"></i>
                                            </span>
                                            <select id="market-type-orderbook2" class="form-select" onchange="updateCurrencyOptionsOrderbook2()">
                                                <option value="">Select Market</option>
                                                <!-- <option value="spot" selected>SPOT</option> -->
                                                <option value="perp" selected>PERP</option>
                                                <!-- <option value="futures">FUTURES</option> -->
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Currency Input -->
                                    <div class="col-md-3 col-sm-12 mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
                                            <select id="currency-input-orderbook2" class="form-select" aria-label="Currency" onchange="updateCurrency()">
                                                <option value="">Select Currency</option>
                               
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Exchange 1 -->
                                    <div class="col-md-3 col-sm-6 mb-3">
                                        <div class="input-group">
                                            
                                            <span class="input-group-text"><i class="bi bi-building"></i></span>
                                            <select id="exchange1-input" class="form-select" aria-label="Exchange 1" onchange="updateExchange(1)" >
                                                <option value="">Select Exchange 1</option>
                                                <option value="okx" selected>OKX</option>
                                                <option value="htx">HTX</option>
                                                <option value="binance">Binance</option>
                                                <option value="deribi">Deribit</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- HTX Open/Close (1) -->
                                    <div id="htx-open-close-wrapper1" class="col-md-3 col-sm-6 mb-3" style="visibility: hidden;">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-gear"></i></span>
                                            <select id="htx-open-close-1" class="form-select" aria-label="Open/Close">
                                                <option value="">SELECT OPEN/CLOSE</option>
                                                <option value="open">OPEN</option>
                                                <option value="close">CLOSE</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Exchange 2 -->
                                    <div class="col-md-3 col-sm-6 mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-building"></i></span>
                                            <select id="exchange2-input" class="form-select" aria-label="Exchange 2" onchange="updateExchange(2)" >
                                                <option value="">Select Exchange 2</option>
                                                <option value="okx">OKX</option>
                                                <option value="htx" selected>HTX</option>
                                                <option value="binance">Binance</option>
                                                <option value="deribi">Deribit</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- HTX Open/Close (2) -->
                                    <div id="htx-open-close-wrapper2" class="col-md-3 col-sm-6 mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-gear"></i></span>
                                            <select id="htx-open-close-2" class="form-select" aria-label="Open/Close">
                                                <option value="">SELECT OPEN/CLOSE</option>
                                                <option value="open">OPEN</option>
                                                <option value="close">CLOSE</option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>

                        <!-- ORDERBOOK AND LAST TRADE SCROLLABLE TABLES -->
                        <div class="row">
                        
                            <div class="container pb-3">
                                <div class="row ">
                                    <!-- First Exchange Last Prices -->
                                    <div class="col-md-3">
                                        <div class="card shadow-sm">
                                            <div class="card-body py-0 my-0">
                                                <h5 id="lastTrade-header-1" class="text-center ">Last Trades</h5>
                                                <!-- Row for Exchange and Currency -->
                                            </div>

                                            <div class="orderbook-scroll-container scrollable-lastprice">
                                               
                                                <table class="orderBookTable">
                                                    <thead>
                                                        <tr class="text-secondary small">
                                                            <th style="position: sticky; top: 0; background-color: #f1f1f1; z-index: 10;">Ts</th>
                                                            <th style="position: sticky; top: 0; background-color: #f1f1f1; z-index: 10;">Price(USD)</th>
                                                            <th style="position: sticky; top: 0; background-color: #f1f1f1; z-index: 10;">Size</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="lastprice-data-table-body-1">
                                                        <!-- Last price data will be dynamically inserted here -->
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>
                                    </div>
                                
                                    <!-- leading Order Book Section -->
                                    <div class="col-md-3" >
                                        <div class="">
                                            <div class="container p-0">
                                                <div class="card shadow-sm">
                                                    <div class="card-body py-0 m-0">
                                                        <h5 id="orderbook-header-1" class="text-center">Order Book 1</h5>
                                                        
                                                        <div id="orderbook-timestamp-1" class="text-center">
                                                            <strong></strong> <span>Not Selected</span>

                                                            <!-- Timestamp content here -->

                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- <div class="scrollable-orderbook"> -->
                                                <div class="scrollable-orderbook overflow-auto border" id="scrollable-orderbook-1" style="height:290px;">

                                                    <table class="orderBookTable" id="orderBookTable1">
                                                        <thead class="bg-light">
                                                            <tr class="text-secondary small">
                                                                <th style="position: sticky; top: 0; background: white; z-index: 2; text-align: center;">Price(USD)</th>
                                                                <th style="position: sticky; top: 0; background: white; z-index: 2; text-align: center;">Size</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="order-data-table-body-1">
                                                      
                                                        </tbody>
                                                    </table>
                                                  
                                                </div>

                                            </div>
                                        
                                        </div>
                                    </div>

                                    <!-- lagging Order Book Section -->
                                    <div class="col-md-3" >
                                        <div class="">
                                            <div class="container p-0">
                                                <div class="card shadow-sm ">
                                                <div class="card-body py-0 my-0">
                                                    <h5 id="orderbook-header-2" class="text-center ">Order Book 2</h5>
                                            
                                                    <!-- Timestamp -->
                                                    <div id="orderbook-timestamp-2" class="text-center">
                                                        <strong></strong> <span>Not Selected</span>
                                                    </div>
                                                </div>
                                                </div>
                                                
                                                <div class="scrollable-orderbook overflow-auto border" id="scrollable-orderbook-2" style="height:290px;">
                                                    <table  id="orderBookTable2">
                        
                                                        <thead class="bg-light">
                                                            <tr class="text-secondary small">
                                                                <th style="position: sticky; top: 0; background: white; z-index: 2; text-align: center;">Price(USD)</th>
                                                                <th style="position: sticky; top: 0; background: white; z-index: 2; text-align: center;">Size</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody id="order-data-table-body-2">
                                                            <!-- Order book data will be dynamically inserted here -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                        <!-- Second Exchange Last Prices -->
                                    <div class="col-md-3">

                                            <div class="card shadow-sm ">
                                                <div class="card-body py-0 my-0">
                                                <h5 id="lastTrade-header-2" class="text-center ">Last Trades</h5>
                                                
                                                </div>
                                                <div class="scrollable-lastprice">
                                                    <table >
                                                    <thead>
                                                        <tr class="text-secondary small">
                                                            <th style="position: sticky; top: -1px;">Ts</th>
                                                            <th style="position: sticky; top: -1px;">Price(USD)</th>
                                                            <th style="position: sticky; top: -1px;">Size</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="lastprice-data-table-body-2">
                                                        <!-- Last price data will be dynamically inserted here -->
                                                    </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        
                                    </div>
                                </div>
                            </div>

                        </div>
                                    
                        <!-- BUTTONS FOR COMPARING -->
                        <div class="row">
                            <div id="securedContentBidAskOrder" class="alert alert-dark" style="display: none;">
                                <!-- Sync and Reset Buttons (Always at the Bottom) -->
                                <div class="rfs-spread-base-cell p-0">
                                    <!-- Header with Bid, Spread, and Ask -->
                                    <div class="RfsSpreadCell_rfs-spread-card-header-container d-flex justify-content-center">
                                        <div class="quote-bps-container d-flex align-items-center ">
                                            <span class="quote-bps-value fw-bold" id="buysellgapPx">-</span>&nbsp;
                                            <span class="quote-bps-unit text-muted">BPS</span>
                                        </div>
                                    </div>
                                    
        
                                    <!-- Card Section for Bid and Ask Prices -->
                                    <div class="RfsSpreadCell_rfs-spread-base-cell-prices d-flex justify-content-center ">
                                        <!-- Bid Card -->
                                        <span id="quote-side-text" class="col quote-side-text text-success text-center fw-bold">
                                            Bid (Buy <span id="arbButton-bid-buy"></span> Sell <span id="arbButton-bid-sell"></span>) 
                                        </span>
                                        <div class="col  quote-price-card buy card p-3 text-center" onclick="handleClick('buy')" role="button" tabindex="0">
                                            <div class="best-quote-price-container">
                                                <div class="price-data fs-4 fw-bold" id="buySpread">-</div>
                                            </div>
                                            <div class="card-bottom-container" >
                                                <div class="card-bottom-quote-diff text-success" id="buySpreadSz">-</div>
                                            </div>

                                        </div>
                                
                                        <!-- Ask Card -->
                                        <div class="col  quote-price-card sell card p-3 text-center border-danger" onclick="handleClick('sell')" role="button" tabindex="0">
                                        
                                            <div class="best-quote-price-container">
                                                <div class="price-data fs-4 fw-bold" id="sellSpread">-</div>
                                            </div>
                                            <div class="card-bottom-container">
                                                <div class="card-bottom-quote-diff text-danger" id="sellSpreadSz">-</div>
                                            </div>

                                        </div>
                                        <span id="quote-side-text" class=" col  quote-side-text text-danger text-center fw-bold ">
                                            Ask (Sell <span id="arbButton-ask-sell"></span> Buy <span id="arbButton-ask-buy"></span>) 
                                        </span>
        
                                    </div>
                                </div>
                            
                            </div>
                        </div>
                        
                </div>
                
            </div>


            <!-- FORM for ordering -->
            <div class="col-lg-6 container-fluid ">

                <!-- This section will only be visible if the JWT is NOT present -->
                <div id="loginPromptBtn" class="alert alert-warning text-center h-100">
                    <h4>You are not logged in.</h4>
                    <p>Please log in to access secured content.</p>
                    <a href="auth.html" class="btn btn-dark" role="button">Log in</a>
                </div>


                <!-- This section will only be visible if the JWT is present -->
                <div id="securedContent" class="alert alert-dark" style="display: none;">
                        
                    <div class="position-relative ">
                        <div class = "text-end ">

                            <button id="notification-icon" class="btn btn-light" onclick="toggleNotificationHub()">
                                üõé Notifications <span id="notification-count" class="badge bg-danger">0</span>
                            </button>
                            <div id="notification-hub" class="notification-hub bg-light shadow rounded" style="display: none;">
                                <h5 class="p-2">Notifications</h5>
                                <div id="toast-list" class="toast-list p-2" style="max-height: 300px; overflow-y: auto;">
                                    <!-- Dynamic Toast Messages Will Appear Here -->
                                </div>
                                
                                <button class="btn btn-secondary w-100" onclick="clearNotifications()">Clear All</button>
                            </div>
                        </div>
                        
                    </div>

                    <!-- <ul class="nav nav-tabs  mb-3"  role="tablist ">
                        <li class="nav-item" role="presentation">
                        <button class="btn nav-link active" id="pills-manual-order-tab" data-bs-toggle="tab" data-bs-target="#pills-manual-order" type="button" role="tab" aria-controls="pills-manual-order" aria-selected="true">Manual Order</button>
                        </li>
                        <li class="nav-item" role="presentation">
                        <button class="btn nav-link" id="pills-algo-order-tab" data-bs-toggle="tab" data-bs-target="#pills-algo-order" type="button" role="tab" aria-controls="pills-algo-order" aria-selected="false">Algo Order</button>
                        </li>
                    </ul> -->

                    <ul class="nav nav-tabs  mb-3"  role="tablist ">
                        <li class="nav-item" role="presentation">
                        <button class="btn nav-link active" id="pills-manual-order-tab" data-bs-toggle="tab" data-bs-target="#pills-manual-order" type="button" role="tab" >Manual Order</button>
                        </li>
                        <li class="nav-item" role="presentation">
                        <button class="btn nav-link" id="pills-algo-order-tab" data-bs-toggle="tab" data-bs-target="#pills-algo-order" type="button" role="tab" >Algo Order</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-manual-order" role="tabpanel" aria-labelledby="pills-manual-order-tab">
                            <!-- MANUAL ORDER FORM Input Section -->
                            <div class="card p-4 ">
                                <form id="order-form">
                                    <form id="order-form">
                                        <div class="row g-2">
                                        
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="leading-exchange-input" class="form-label">
                                                    Leading
                                                    <!-- Tooltip Icon -->
                                                    <span class="tooltip-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Your order applies to this exchange">
                                                    <i class="bi bi-info-circle"></i>
                                                    </span>
                                                </label>
                                                
                                                <select id="leading-exchange-input" class="form-select" required>
                                                    <option value="" disabled selected>Select Exchange</option>
                                                    <option value="none">NA</option>
                                                    <option value="htx">HTX</option>
                                                    <option value="okx" selected>OKX</option>
                                                </select>
                                            </div>
                                    
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="lagging-exchange-input" class="form-label">Lagging:</label>
                                                <select id="lagging-exchange-input" class="form-select" required>
                                                    <option value="" disabled selected>Select Exchange</option>
                                                    <option value="none">NA</option>
                                                    <option value="htx" selected>HTX</option>
                                                    <option value="okx">OKX</option>
                                                </select>
                                            </div>
                                    
                                            <!-- Instrument Field for Spot/Swap -->
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="instrument-input" class="form-label">Instrument:</label>
                                                <select id="instrument-input" class="form-select" required onchange="updateCurrencyOptionsGeneral('instrument-input','manual-order-form-currency-input','contract-type-container')">
                                                    <option value="" disabled selected>Select Instrument</option>
                                                    <option value="spot">Spot</option>
                                                    <option value="swap" selected>Swap</option>
                                                    <option value="futures" >Futures</option>

                                                </select>
                                            </div>
                                        
                                    
                                            <!-- Order Type Tabs -->
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="order-type-input" class="form-label">Order Type:</label>
                                                <select id="order-type-input" class="form-select" required onchange="handleOrderTypeChange()">
                                                    <option value="" disabled selected>Select Order Type</option>
                                                    <option value="market" >Market</option>
                                                    <option value="limit" selected>Limit</option>
                                                    <option value="algo">Algo</option>

                                                </select>
                                            </div>
                                    
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="manual-order-form-currency-input" class="form-label">Currency Pair:</label>
                                                <select id="manual-order-form-currency-input" class="form-select" required>
                                                    <option value="">Select Currency Pair</option>
                                                    <option value="BTC-USD-SWAP">BTC-USD-SWAP</option>
                                                </select>
                                            </div>
                                    
                                            <!-- Contract Type Field (Initially Hidden) -->
                                            <div class="col-12 col-md-6 mb-3" id="contract-type-container" style="display: none;">
                                                <label for="contract-type-input" class="form-label">Contract Type:</label>
                                                <select id="contract-type-input" class="form-select">
                                                    <option value="" disabled selected>Select Contract Type</option>
                                                    <option value="this_week">This Week</option>
                                                    <option value="next_week">Next Week</option>
                                                    <option value="quarter">Quarter</option>
                                                </select>
                                            </div>
                                            
                                            <!-- Price field (two inputs side by side for Price 1 and Price 2) -->
                                            <div class="col-12 col-md-12 mb-3" id="price-container">
                                                <div class="row">
                                                    <div class="col-6" id="form-container-price1-input">
                                                        <label for="price-input-1" class="form-label">Price 1:</label>
                                                        <input type="number" id="price-input-1" class="form-control" placeholder="Price" required>
                                                    </div>
                                                    <div class="col-6" id="form-container-price2-input">
                                                        <label for="price-input-2" class="form-label">Price 2:</label>
                                                        <input type="number" id="price-input-2" class="form-control" placeholder="Price" required>
                                                    </div>
                                                </div>
                                            </div>
                                    
                                            <!-- Spread field -->
                                            <div class="col-12 col-md-6 mb-3" id="spread-container">
                                                <label for="spread-input" class="form-label">Spread:</label>
                                                <input type="number" id="spread-input" class="form-control" placeholder="Spread">
                                            </div>
                                    
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="qty-input" class="form-label">Quantity:</label>
                                                <input type="number" id="qty-input" class="form-control" placeholder="Quantity" value="1" required>
                                            </div>

                                        </div>

                                        <div id="form-buy-sell-container">
                                            <div class="d-flex justify-content-between mt-3" >
                                                <button type="submit" id="buy-button" value="buy" class="btn btn-success w-100 me-1">Buy</button>
                                                <button type="submit" id="sell-button" value="sell" class="btn btn-danger w-100 ms-1">Sell</button>
                                            </div>
                                        </div>
                                    
                                    </form>
                                    
                                    
                                    <script>
    

                                        // Simulate condition for triggering warning
                                        function checkCondition() {
                                            console.log("Condition checked")
                                            const formdata = new FormData();
                                            formdata.append("username", localStorage.getItem('username'));
                                            const check_alert_status = {
                                                method: "POST",
                                                body: formdata,
                                            };
                                            fetch(`http://${hostname}:9000/check_alert_status`, check_alert_status)
                                            .then((response) => response.json())
                                            .then((result) =>
                                                {
                                                console.log(result)
                                                if (result.status == "INACTIVE"|result.status == "ACTIVE_ACKED"){
                                                    console.log(result.status)
                                                    document.getElementById('alertBox').style.display = "None"
                                                    // document.getElementById('alertBox').style.display = "block"

                                                }else{
                                                    document.getElementById('alertBox').style.display = "block"
                                                }

                                                // if (result['answered'] || result['running']) {
                                                //     // Do something here
                                                //     console.log("Alert status triggered:", result);
                                                // }
                                            })
                                            .catch((error) => console.error(error));
                                        
                                        }
                                        document.addEventListener('DOMContentLoaded', checkCondition);

                                        function handleOrderTypeChange() {

                                            const orderType = document.getElementById('order-type-input').value;
                                            const priceContainer = document.getElementById('price-container');
                                            const spreadContainer = document.getElementById('spread-container');
                                            const priceInputs = priceContainer.querySelectorAll('input');
                                            const formBuySellContainer = document.getElementById('form-buy-sell-container');

                                            // Show or hide fields based on selected order type
                                            if (orderType === 'market') {
                                                priceContainer.style.display = 'none';
                                                spreadContainer.style.display = 'none';
                                                formBuySellContainer.style.display = 'block';
                                                priceInputs.forEach(input => input.removeAttribute('required'));

                                            } else if (orderType === 'limit') {
                                                priceContainer.style.display = 'block';
                                                spreadContainer.style.display = 'none';
                                                formBuySellContainer.style.display = 'block';

                                            } else if (orderType === 'algo') {
                                                formBuySellContainer.style.display = 'none';
                                                priceContainer.style.display = 'block';
                                                spreadContainer.style.display = 'block';

                                            
                                            } else {
                                                formBuySellContainer.style.display = 'block';
                                                priceContainer.style.display = 'none';
                                                spreadContainer.style.display = 'none';
                                            }
                                        }

                                        document.querySelectorAll('.form-check-input').forEach(toggle => {
                                            toggle.addEventListener('change', (event) => {
                                                const isChecked = event.target.checked;
                                                console.log(`${event.target.id} is now ${isChecked ? 'ON' : 'OFF'}`);
                                            });
                                        });
                                    
                                        // Initialize form on page load
                                        
                                        document.addEventListener('DOMContentLoaded', handleOrderTypeChange);

                                        


                                    </script>

                                </form>
                                
                            </div>
                        </div>


                        
                        <div class="tab-pane fade " id="pills-algo-order" role="tabpanel" aria-labelledby="pills-algo-order-tab">
                            <div>
                            <!-- Algo Strats Table -->
                            <!-- Algo List Table -->
                            <section >
                                <div class="table-responsive" style="max-height: 520px; overflow-y: auto;">
                                    <table class="table table-hover table-sm align-middle text-nowrap w-100 algo-table">
                                        <thead class="table-light sticky-top">
                                            <tr class="text-uppercase small">
                                                <th class="">Algo Name</th>
                                                <th class="">Lead / Lag</th>
                                                <th class="">Direction / Offset</th>
                                                <th class="">Spread / Qty</th>
                                                <th class="">Currency</th>
                                                <th class="">Instrument / Contract</th>
                                                <th class="">Status</th>
                                                <th class="">On / Off</th>
                                                <th class="">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="algo-list"></tbody>
                                        <tbody id="algo-list-new"></tbody>
                                    </table>
                                </div>
                            
                            </section> 
                            <!-- ALGO ORDER FORM Input Section -->

                                <!-- Button to Open Modal -->
                                <button class="btn btn-dark " onclick="openAlgoModal()">Add New Algo</button>

                                <!-- Modal for Adding/Editing Algo -->
                                <div class="modal" id="algoModal" tabindex="">
                                    
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">

                                            <div class="modal-header">
                                                <h5 class="modal-title" >Add New Algo</h5>
                                                <!-- <button type="button" class="btn-close" onclick="closeAlgoModal()"></button> -->
                                            </div>
                                            
                                            <div class="modal-body">
                                                <form id="new-algoForm">

                                                    <!-- Algo Type and Algo name -->
                                                    <div class="row">
                                                        <div class="input-group mb-3">
                                                            <!-- Input Field -->
                                                            <div class="input-group-prepend">
                                                                <select class="form-select" id="new-algo-type" onchange="setnewAlgoType(this)" required>
                                                                    <option value="" disabled >Select Algo Type</option>
                                                                    <option value="diaoyu" selected>Diaoyu</option>
                                                                    <option value="diaoxia" >Diaoxia</option>
                                                                    <!-- Additional options can be added here -->
                                                                </select>
                                                            </div>

                                                            <input type="text" class="form-control" id="new-algo-name" placeholder="Type algo name" >

                                                        </div>
                                                    </div>

                                                    <!-- Lead and Lag Exchanges -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label for="new-algo-lead-exchange" class="form-label">Lead Exchange</label>
                                                            <select class="form-select" id="new-algo-lead-exchange" >
                                                                <option value="okx" selected>OKX</option>
                                                                <option value="htx">HTX</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="new-algo-lag-exchange" class="form-label" >Lag Exchange</label>
                                                            <select class="form-select" id="new-algo-lag-exchange" >
                                                                <option value="okx">OKX</option>
                                                                <option value="htx" >HTX</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                     <!-- direction and Offset -->
                                                     <div class="row mt-3">
                                                        <div class="col-md-6">
                                                            <label for="new-algo-direction" class="form-label">Direction</label>

                                                            <select class="form-select" id="new-algo-direction">
                                                                <option value="buy">BUY</option>
                                                                <option value="sell" selected>Sell</option>
                                                            </select>

                                                        </div>

                                                        <div class="col-md-6" id="new-algo-offset-container" style="display: none;">
                                                            <label for="new-algo-offset" class="form-label">Offset</label>

                                                            <select class="form-select" id="new-algo-offset" >
                                                                <option value="open">Open</option>
                                                                <option value="close" selected>Close</option>
                                                            </select>
                                                        </div>

                                                 
                                                        
                                                    </div>

                                                    <!-- Spread and Quantity -->
                                                    <div class="row mt-3">
                                                        <div class="col-md-6">
                                                            <label for="new-algo-spread" class="form-label">Spread</label>
                                                            <input type="number" step="0.01" class="form-control" id="new-algo-spread" placeholder="Enter Spread">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="new-algo-quantity" class="form-label">Quantity</label>
                                                            <input type="number" class="form-control" id="new-algo-quantity" placeholder="Enter Quantity">
                                                        </div>
                                                    </div>
                                                   


                                                    <!-- Instrument and Contract Type -->
                                                    <div class="row mt-3">
                                                        <div class="col-md-6">
                                                            <label for="new-algo-instrument" class="form-label">Instrument</label>
                                                            <select class="form-select" id="new-algo-instrument" onchange="updateCurrencyOptionsGeneral('new-algo-instrument','new-algo-ccy','new-algo-contract-type-container')">
                                                                <option value="swap" selected>SWAP</option>
                                                                <option value="futures">FUTURES</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="new-algo-ccy" class="form-label">Currency</label>
                                                            <select class="form-select" id="new-algo-ccy">
                                                                <option value="na"  disabled>Select a currency</option>
                                                                <option value="BTC-USD-SWAP" selected >BTC-USD</option>

                                                            </select>
                                                        </div>
                                                        <div class="col-md-6" id="new-algo-contract-type-container" style="display: none;">
                                                            <label for="new-algo-contract-type" class="form-label">Contract Type</label>
                                                            <select class="form-select" id="new-algo-contract-type">
                                                                <option value="thisweek" selected>This Week</option>
                                                                <option value="nextweek">Next Week</option>
                                                                <option value="quarter">Quarter</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    
                                                    <div class="form-check form-switch mt-3">
                                                        <input class="form-check-input" type="checkbox" id="new-algo-status" disabled>
                                                        <label class="form-check-label" for="new-algo-status">Active</label>
                                                    </div>
                                                    
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" onclick="closeAlgoModal()">Cancel</button>
                                                <button type="button" class="btn btn-dark" onclick="saveAlgo()">Save</button>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
            

            </div>

            <!-- Order Management System Section -->
            <div id="securedContentOMS" class="alert alert-dark" style="display: none;">
                <div class="card p-3">
                    <!-- <h2 class="text-center">Order Management System (Prototype)</h2> -->

                    <!-- Tabs -->
                    <ul class="nav nav-tabs flex-wrap" id="omsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="btn nav-link active" data-bs-toggle="tab" data-bs-target="#assets-positions" type="button" role="tab">Assets & Positions</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="btn nav-link" data-bs-toggle="tab" data-bs-target="#open-orders" type="button" role="tab">Open Orders</button>
                        </li>
                    
                    </ul>
                    <div class="tab-content mt-3">
                        <!-- Assets & Positions Tab -->
                        <div class="tab-pane fade show active" id="assets-positions" role="tabpanel">
                            
                            <p >
                                <button id="positions-refresh-btn" class="btn btn-dark btn-sm  mb-2" onclick="populatePositions()">Refresh</button>
                                
                                <tag class="text-end float-end text-muted">
                                    Last updated: <span id="last-updated-positions">-</span>
                                </tag>
                            </p>
    


                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-borderless table-hover  text-nowrap w-100 OMStable">
                                    <thead class="table-primary  sticky-top">
                                        <tr>
                                            <th >Exchange</th>
                                            <th >Instrument ID</th>
                                            <th >Lev</th>
                                            <!-- <th >Mgn Ratio</th> -->
                                            <th >Position (Buy/Sell)</th>
                                            <th >ADL</th>
                                            <th >Liquidation Price</th>
                                            <th >Avg Price</th>
                                            <th >PnL</th>
                                            <th >Ts</th>
                                        </tr>
                                    </thead>
                                    <tbody id="oms-open-positions-body">
                                        <!-- Dynamic rows inserted here -->
                                    </tbody>
                                </table>
                            </div>

                        </div>



                        <!-- Open Orders Tab -->
                        <div class="tab-pane fade" id="open-orders" role="tabpanel">
                        
                            <div>
                                <!-- First button (aligned left) -->
                                <button id="positions-refresh-btn" class="btn btn-dark btn-sm mb-2" onclick="populateOpenOrders()">Refresh</button>
                                <!-- Last updated (aligned right) -->
                                <tag class="text-end float-end text-muted">
                                    Last updated: <span id="last-updated-orders">-</span>
                                </tag>
                                <!-- Second and third buttons (centered) -->
                                <!-- BUTTONS DANGEROUS -->
                                <div class="d-flex justify-content-center align-items-center mb-2">
                                    <!-- Currency Selector -->
                                    <select id="clearCurrencyDropdown" class="form-select form-select-sm mx-2" style="width: auto;">
                                        <option value="all" selected>All Currencies</option>
                                        <option value="BTC-USD-SWAP">BTC-USD-SWAP</option>
                                    </select>
                                    <!-- Lock/Unlock Button -->
                                    <!-- Action Buttons -->
                                    <button id="positions-clear-all-btn" class="btn btn-danger btn-sm mx-2" onclick="clearPositions('all')" disabled>Clear All</button>
                                    <button id="positions-clear-okx-btn" class="btn btn-warning btn-sm mx-2" onclick="clearPositions('okx')" disabled>Clear OKX</button>
                                    <button id="positions-clear-htx-btn" class="btn btn-warning btn-sm mx-2" onclick="clearPositions('htx')" disabled>Clear HTX</button>
                                    <button id="lock-clear-btn" class="btn btn-secondary btn-sm mx-2" onclick="toggleLockClear()">üîí Unlock</button>
                                </div>
                            
                            </div>
                            
                        
                            

                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-striped table-bordered table-hover table-sm align-middle text-nowrap w-100 OpenOrdersTable">
                                    <thead class="sticky-top">
                                        <tr>
                                            <th style="width: 8%;">Exchange</th>
                                            <th style="width: 5%;">Symbol</th>
                                            <th style="width: 5%;">Lev</th>
                                            <th style="width: 6%;">Side</th>
                                            <th style="width: 12%;">Fill / Order Price</th>
                                            <th style="width: 12%;">Filled / Total</th>
                                            <th style="width: 13%;">Status / Order #</th>
                                            <th style="width: 10%;">Order Time</th>
                                            <!-- <th style="width: 7%;">Action 1</th> -->
                                            <th style="width: 20%;">Action 2</th>
                                        </tr>
                                    </thead>
                                    <tbody id="oms-open-orders-body">
                                        <!-- Dynamic rows inserted here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            
                            
                        </div>

                    </div>
                    
                </div>
            </div>

            <!-- Placeholder Modal - will not be displayed. only displayed when button is pressed-->
            <div id="modifyPositionModal" class="modal" tabindex="-1" style="display: none;">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Modify Position</h5>
                            <button type="button" class="btn-close" onclick="closeModifyOrderModal()"></button>
                        </div>
                        <div class="modal-body">
                            <form id="modifyPositionForm">
                                <!-- Form fields will be dynamically added here -->
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeModifyOrderModal()">Cancel</button>
                            <button type="submit" form="modifyPositionForm" class="btn btn-dark">Submit</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <script src="./websocket_client/js/twiliocall.js"></script>
        <script src="./websocket_client/js/auth.js"></script>
        <script src="websocket_client/js/util.js"></script>
        <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
        <script src="websocket_client/js/wsConnections.js"></script>
        <script src="websocket_client/js/display_last_trade.js"></script>
        <script src="websocket_client/js/display_orderbook.js"></script>
        <script src="websocket_client/js/display_position.js"></script>
        <script src="websocket_client/js/display_open_orders.js"></script>
        <script src="websocket_client/js/arbButton.js"></script>
        <script src="websocket_client/js/createAlgoOrders.js"></script>
        <!-- <script src="websocket_client/js/display_trade_history.js"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
        <script src="websocket_client/js/display_fundingrate.js"></script>

        <script>

            let shouldScrollState = {}


            // Clear JWT token from localStorage when no longer needed
            function clearAuthToken() {
                localStorage.removeItem('jwt_token');
            }

            // Clear notifications when user logs out or navigates away
            function clearAllDataOnLogout() {
                clearAuthToken();
                clearNotifications();
            }

            // Remove event listener when no longer needed
            window.removeEventListener('beforeunload', () => {
                clearAuthToken();
                clearNotifications();
            });


            let currency_pair = null;
            
            function getAuthToken() {
                return localStorage.getItem('jwt_token');  // You can change this to sessionStorage if needed
            }

            function updateExchange(which) {
                    // let shouldScroll = !container.dataset.hasScrolled;
                    const scrollableOrdebook = document.getElementById(`scrollable-orderbook-${which}`);
                    // console.log(which)
                    // scrollableOrdebook.dataset.hasScrolled = 'true'
                    // shouldScrollState[which] = !scrollableOrdebook.dataset.hasScrolled;
                    // console.log(shouldScrollState[which])

                    const exchangeId = `exchange${which}-input`;
                    const wrapperId = `htx-open-close-wrapper${which}`;
                    const selectedExchange = document.getElementById(exchangeId).value.toLowerCase();
                    const wrapper = document.getElementById(wrapperId);
                    const dropdown = document.getElementById(exchangeId);

                    // Show/Hide HTX-specific dropdown
                    if (selectedExchange === 'htx') {
                        wrapper.style.visibility = 'visible';
                    } else {
                        wrapper.style.visibility = 'hidden';
                    }

                    // Temporarily disable dropdown to avoid race condition / coroutine issues
                    dropdown.disabled = true;

                    // Send WebSocket message or whatever async operation here
                    if (which === 1 && typeof socket1 !== 'undefined') {
                        const input_data = {
                            action: "change",
                            ccy: document.getElementById('currency-input-orderbook1').value,
                            exchange: selectedExchange,
                            market_type: document.getElementById('market-type-orderbook1')?.value || ""
                        };
                        socket1.send(JSON.stringify(input_data));
                    }

                    if (which === 2 && typeof socket2 !== 'undefined') {
                        const input_data = {
                            action: "change",
                            ccy: document.getElementById('currency-input-orderbook2').value,
                            exchange: selectedExchange,
                            market_type: document.getElementById('market-type-orderbook2')?.value || ""
                        };
                        socket2.send(JSON.stringify(input_data));
                    }

                    // Re-enable after delay (adjust time as needed)
                    setTimeout(() => {
                        dropdown.disabled = false;
                    }, 1500); // 1.5s delay to let coroutine settle
                }




            // Check if the JWT token is present and display the corresponding content
            function checkJWTAndDisplay() {
                const token = getAuthToken();
                // Get the elements by ID
                const securedContent = document.getElementById('securedContent');
                const securedContentOMS = document.getElementById('securedContentOMS');
                const securedContentBidAskOrder = document.getElementById('securedContentBidAskOrder');

                // securedContentBidAskOrder
                const loginPrompt = document.getElementById('loginPrompt');
                var loginPromptBtn = document.getElementById('loginPromptBtn');

                

                if (token) {
                    // If the token is present, show the secured content
                    securedContent.style.display = 'block';
                    securedContentOMS.style.display = 'block';
                    securedContentBidAskOrder.style.display = 'block';

                    loginPrompt.style.display = 'none';
                    loginPromptBtn.style.display = 'none';

                } else {
                    // If the token is not present, show the login prompt
                    securedContent.style.display = 'none';
                    securedContentOMS.style.display = 'none';
                    securedContentBidAskOrder.style.display = 'none';

                    loginPrompt.style.display = 'block';
                    loginPromptBtn.style.display = 'block';
                    
                }
            }

            // Run the function to check the JWT token and display appropriate content
            checkJWTAndDisplay();

            // Array to store notifications
            const notifications = [];
            
            function updateNotificationHub() {
                const toastList = document.getElementById('toast-list');

                toastList.innerHTML = ''; // Clear previous notifications
            
                let orderIdColor = 'bg-secondary'; // Grey by default
                let statusColor = 'bg-secondary'; // Grey by default
                let errColor = 'bg-secondary';   // Grey by default
                notifications.forEach(notification => {
                    // if (notification.statusCode == 200) statusColor = 'bg-success';
                    let orderIdColor = notification.orderId != null ? 'bg-success' : 'bg-danger';
                    let statusColor = notification.statusCode == 200? 'bg-success' : 'bg-danger';
                    let errColor = notification.errCode == null | notification.errCode =='undefined' ? 'bg-success' : 'bg-danger';


                    const toastItem = document.createElement('div');
                    toastItem.className = `toast-item toast-${notification.type}`;
                    toastItem.innerHTML = `
                    <div class="toast-item mb-2 p-3 rounded shadow text-start" style="background-color: #f9f9f9;">

                        <div class="toast-header d-flex align-items-center">
                            <strong class="me-2">[${notification.apiSource}]</strong> 
                            <div class="ms-auto">
                                <span class="badge ${orderIdColor}">Order ID: ${notification.orderId}</span>
                                <span class="badge ms-1 ${statusColor}">Status: ${notification.statusCode}</span>
                                <span class="badge ms-1 ${errColor}">Error: ${notification.errCode}</span>
                            </div>
                        </div>

                        <div class="toast-body">
                            <p class="mb-1">${notification.message}</p>
                            <small class="text-muted">${notification.timestamp}</small>
                        </div>
                    </div>
                    `;
                    toastList.prepend(toastItem);
                });
            }

            // Toggle Notification Hub visibility
            function toggleNotificationHub() {
                const hub = document.getElementById('notification-hub');
                hub.style.display = hub.style.display === 'none' ? 'block' : 'none';
            }

            // Update notification count
            function updateNotificationCount() {
                const count = notifications.length;
                document.getElementById('notification-count').innerText = count;
            }

            // Clear all notifications
            function clearNotifications() {
                notifications.length = 0;
                updateNotificationHub();
                updateNotificationCount();
            }

            // Function to update the table for the selected currency
            function updateTableForCurrency(currency) {
                // console.log(currency_pair)
                
                document.querySelector('h4').innerText = `Order Book Comparison for ${currency}`;
                // TODO: Fetch new data and update order books dynamically here
                alert(`Order books updated for ${currency}`);
                currency_pair = currency
                // console.log(currency_pair)
            }


        $('.OMStable').DataTable({
            autoWidth: false,
            paging: true,
            searching: true,
            ordering: true,
            info: true,
            pageLength: 10,        // Default number of rows per page
            lengthMenu: [5, 10, 25, 50], // Dropdown menu for page length
            order: [[1, 'asc']],   // Default sorting (e.g., by Instrument ID)
            language: {
                search: "Filter records:", // Customize search input placeholder
                lengthMenu: "Display _MENU_ records per page"
            }
        });

        $('.OpenOrdersTable').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            info: true,
            pageLength: 10,        // Default number of rows per page
            lengthMenu: [5, 10, 25, 50], // Dropdown menu for page length
            order: [[1, 'asc']],   // Default sorting (e.g., by Instrument ID)
            language: {
                search: "Filter records:", // Customize search input placeholder
                lengthMenu: "Display _MENU_ records per page"
            }
            
        });

        $('').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            info: true,
            pageLength: 10,        // Default number of rows per page
            lengthMenu: [5, 10, 25, 50], // Dropdown menu for page length
            order: [[1, 'asc']],   // Default sorting (e.g., by Instrument ID)
            language: {
                search: "Filter records:", // Customize search input placeholder
                lengthMenu: "Display _MENU_ records per page"
            }
            
        });

        
        </script>
        
        <style>

            
            .normal-text{
                color:black
            }

            .header-text{
                font-family: 'Orbitron', sans-serif;
                color:black
            }

            .form-control{
                font-size:small;
                /* color:#ddd */
                color:black
            }

            .algo-order-form-control{
                font-size: small;
                padding-left:5px;
                padding-right:5px;
                width:100%;
            }
        
            .navbar-brand{
                font-family: 'Orbitron', sans-serif;
                font-size: 2.75rem;
                letter-spacing: 1px;
            }

            .welcome-text{
                color: #ffffff;

            }
            .background{
                /* background-color:rgba(1, 14, 4, 0.512) */

            }

            .nav-pills .nav-link.active{
                background-color: black;
            }
            .nav-link{
                color: grey;
            }

            .alert-dark{
                /* background-color:rgba(99, 1, 1, 0.707) */
            }

           
          
           
            /* Make sure the parent container is a flex container */
            .orderbook-container {
                width:70%;
                display: flex;
                justify-content: space-between;  /* Ensure orderbooks are side by side */
                gap: 15px; /* Space between each orderbook */

            }

            /* th, td {
                width: 25%; 
                overflow: hidden;
                text-align: center;
            
            } */
            
            .btn{
                font-family: 'Orbitron', sans-serif;

            }
            
            /* Set a fixed width for each orderbook container */
            .scrollable-orderbook {
                max-height: 290px;
                box-sizing: border-box;
                }

               .scrollable-orderbook th, td {
                width: 25%; 
                overflow: hidden;
                text-align: center;
            
            }

            .scrollable-orderbook .asks ,.sell {
                color: red;
            }

            /* Style for Bids (Green) */
            .scrollable-orderbook .bids , .buy {
                color: green;
            }

        

            .scrollable-lastprice {
                max-height: 300px; /* Set a fixed height for uniformity */
                    overflow-y: auto;  /* Enable vertical scrolling */
                    border: 1px solid #ddd;  /* Optional border styling */
                    /* padding: 10px; */
                    /* background-color: #f9f9f9; Light background for better readability */
                    display: flex;
                    flex-direction: column;
                    gap: 5px;  /* Add gap between asks and bids */
                    box-sizing: border-box; /* Include padding and border in the element's total width */
                    scroll-behavior: smooth;  /* Smooth scrolling for a better experience */
                    scrollbar-width: thin; 
                }


            /* Optional: Ensures each ask/bid has a consistent font size and line height */
                       /* Style for Asks (Red) */
           
            .run-button {
                    color: #1db954; /* Spotify green */
                    cursor: pointer;
                    font-size: 1.5rem;
                    transition: transform 0.2s ease;
                }
            .stop-button {
                color: #df0d0d; /* Spotify green */
                cursor: pointer;
                font-size: 1.5rem;
                transition: transform 0.2s ease;
            }
                

            /* algo table */
            .algo-table {
                max-height: 550px; /* Set a fixed height for uniformity */
                overflow-y: auto;  /* Enable vertical scrolling */
                padding: 10px;
                scroll-behavior: smooth;  /* Smooth scrolling for a better experience */
                scrollbar-width: thin; 
            }
            
            
              

            /* .table-hover tbody tr:hover {
                background-color: #f9f9f9; /* Subtle hover effect
            }
        


        </style>
    </div>
</body>

</html>